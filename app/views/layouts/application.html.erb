<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Dehradun Feedback Portal</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- cssbundling-rails output -->
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>

    <!-- jsbundling-rails output (Stimulus/Turbo, etc.) -->
    <%= javascript_include_tag "application", type: "module", defer: true %>
  </head>

  <body class="bg-stone-50 text-stone-800 antialiased">
    <!-- Top Navigation -->
    <nav class="border-b border-stone-200 bg-white/90 backdrop-blur-lg">
      <div class="mx-auto max-w-7xl px-4 sm:px-6">
        <div class="flex h-16 items-center justify-between">
          
          <!-- Brand -->
          <div class="flex items-center gap-3">
            <div class="h-9 w-9 rounded-xl bg-indigo-600/10 grid place-items-center shadow-sm">
              <span class="text-indigo-700 font-semibold">D</span>
            </div>
            <div class="leading-tight">
              <div class="font-semibold tracking-tight">Dehradun Feedback Portal</div>
              <div class="text-xs text-stone-500">School Transport Feedback</div>
            </div>
          </div>

          <!-- Primary Nav -->
          <div class="hidden md:flex items-center gap-6 text-sm">
            <%= link_to "Home", root_path, class: "text-stone-600 hover:text-stone-900" %>
            <%= link_to "Submit Feedback", new_feedback_path, class: "text-stone-600 hover:text-stone-900" %>

            <% if user_signed_in? %>
              <%= link_to "Dashboard", admin_dashboard_feedbacks_path, class: "text-stone-600 hover:text-stone-900" %>

              <% if current_user.admin? || current_user.rto_user? %>
                <%= link_to "All Feedback", feedbacks_path, class: "text-stone-600 hover:text-stone-900" %>
                <%= link_to "Reports", (respond_to?(:reports_path) ? reports_path : "#"), class: "text-stone-600 hover:text-stone-900" %>

                <% if current_user.admin? %>
                  <%= link_to "Users", admin_users_path, class: "text-stone-600 hover:text-stone-900" %>
                  <%= link_to "Districts", admin_districts_path, class: "text-stone-600 hover:text-stone-900" %>
                  <%= link_to "Schools", admin_schools_path, class: "text-stone-600 hover:text-stone-900" %>
                <% end %>
              <% end %>
            <% end %>
          </div>

          <!-- Right: Auth area -->
          <div class="flex items-center gap-3 text-sm">
            <% if user_signed_in? %>
              <span class="hidden sm:inline text-stone-600">
                <%= current_user.role.humanize %>
                <% if current_user.school_user? && current_user.school %>
                  — <%= current_user.school.name %>
                <% end %>
              </span>
              <%= link_to "Sign out", destroy_user_session_path,
                          data: { turbo_method: :delete },
                          class: "text-stone-600 hover:text-stone-900" %>
            <% else %>
              <%= link_to "Admin Login", new_user_session_path, class: "text-stone-600 hover:text-stone-900" %>
            <% end %>
          </div>
        </div>
      </div>
    </nav>

    <!-- Flash messages -->
    <div class="mx-auto max-w-3xl px-4 sm:px-6">
      <% if notice.present? %>
        <div class="mt-6 rounded-2xl border border-indigo-200 bg-indigo-50 px-4 py-3 text-sm text-indigo-900 shadow-sm">
          <%= notice %>
        </div>
      <% end %>
      <% if alert.present? %>
        <div class="mt-6 rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-900 shadow-sm">
          <%= alert %>
        </div>
      <% end %>
    </div>

    <!-- Page Content -->
    <main class="mx-auto max-w-7xl px-4 sm:px-6 py-8">
      <%= yield %>
    </main>

    <!-- Footer -->
    <footer class="mt-12 border-t border-stone-200 bg-white/60">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 py-8 text-xs text-stone-500">
        © <%= Time.current.year %> Dehradun RTO · Feedback improves safety & service quality.
      </div>
    </footer>
  </body>
</html>
